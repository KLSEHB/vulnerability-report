Schoolmate v1.3 is vulnerable to a second-order SQL Injection in the variable  $username from SESSION in ValidateLogin.php.
CVE-2023-40946


16.	  $_SESSION["username"] = $_POST["username"];
17.	
18.	  //Get user's type//
19.	  $query = mysql_query("select type from users where username = '$_SESSION[username]'")
20.	     or die("Unable to get user type: " . mysql_error());
21.	
22.	  $_SESSION["usertype"] = mysql_result($query,0);
23.	
24.	  //Get user's ID//
25.	
26.	  $query = mysql_query("select userid from users where username = '$_SESSION[username]'")
27.	     or die("Unable to get userid from users: " . mysql_error());


In line 16 of the code, $_SESSION["username"] directly receives the value from $_POST["username"]. 
Then in line 19, this received value is directly passed into an SQL statement to query the "type" column in the "users" table. In line 26, the same variable is again passed into an SQL statement for querying "userid".

Clearly, the potential vulnerabilities introduced by lines 19 and 26 are similar. When an attacker submits "admin' or 1=1 #" through a POST request, the statement executed in line 19 becomes "select type from users where username = 'admin' or 1=1 #'", 
resulting in the leakage of all "type" data in the "users" table. Similarly, the SQL statement executed in line 26 becomes "select userid from users where username = 'admin' or 1=1 #'", leading to the leakage of all "userid" data.

Furthermore, if a user inputs "1'; system shutdown;#", the SQL statement executed in line 19 will become "select type from users where username = '1'; system shutdown;#'", causing a database shutdown. The SQL statement in line 26 will not be executed in this case.
